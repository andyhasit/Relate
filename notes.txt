
Should ChildrenOfParentCollection be passed it's ParentOfChildCollection?
So that it can find which indexEntry has a child.
  - so it can do the unlinking from existing parent itself in .link()
  - so it can do the unlinking when told to .forget() // which will to a type check on the item that it is asked to forget.
  
That way, collections can be told of relationships they need to call forget() on when an item is deleted.

projects.registerRelationship()

So when it deletes an item, it goes via the relationship object, which deletes all the child items and removes references from lnk collections.


So if a task exists in a project, and in a schedule, we tell the task collection about those relationships.
When a project is deleted, it informs the task-project relationship, which:
    recognising it as the parent in the relationship, calls task collection.delete() on each task, which
        informs the task-project relationship, which:
            recognising it as the child, unlinks itself by deleting records in both collections.
            
            
            
            (no child
    unlinks the tasks from their project 
    
    
    deletes all the tasks, which each:
        informs the relat

maybe have a flag to indicate if in a cascade delete operation, in which case, child items don't bother deleting themselves from childrenOfParent collection
as that entry will be deleted anyway (and it would create lots of db operations.

Done:
    tests for Collection with db mock.
    use strict    
    test ParentOfChildCollection functions
        test correct type is being saved
        move naming into collections
    move repeat code in tests up to beforeEach()
Next steps:
    test ChildrenOfParentCollection functions
    
    test ParentOfChildCollection
    
    test collection remove calls relationship
    move _fetch
    
later:
    many to many relationship
    what about enforcing parameters for new objects?
    
    get delete registering
    Can certain collections be lazy loaded? Like notes? In that case may we need a one-to-one relationship? And if this is the case we'd load by query, not allDocs.



    SO question:
      I have collections with parent child relationships. I use an object to manage each of the relationships (e.g. TaskInProjectRelationshipManager).
      A RelationshipManager coordinates two collection managers: parentOfChild and childrenOfParent.
      Those essentially keep track of what is in the database.
      
      They fire db operations which rely on promises.
      
      So their states are not updated synchronously.
      
      I have an angular app which uses CouchDB/PouchDb. Some documents represent entities, some represent a relationship.
      I also have providers whose state reflects what is in the db.
      
      Do I chain all promises.
      
      E.g. I delete a project, it deletes all tasks, and all documents representing the links between tasks and projects.
      
      I need these to be carried out in the sequence I expect them.
      
      I could use http://www.codeducky.org/q-serial/
      But in my case, I just want them to resolve in the sequence I asked for.
  
  